<!doctype html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>Canvas Drag and Drop Test</title>
</head>
<body>
	<section>
		<div>
			<canvas id="canvas" width="400" height="300">
				This text is displayed if your browser does not support HTML5 Canvas.
			</canvas>
		</div>

		<script type="text/javascript">

			var canvas;
			var currentGrag;
			var ctx;
			var listNode;
			var WIDTH = 400;
			var HEIGHT = 300;
			var dragok = false;

			function rect() {
				for(var i = 0; i < listNode.length; i++)
				{
					ctx.beginPath();
					ctx.rect(listNode[i].posx, listNode[i].posy, 60, 60);
					ctx.closePath();
					ctx.fill();
				}
			}


			function clear() {
				ctx.clearRect(0, 0, WIDTH, HEIGHT);
			}

			function init() {
				canvas = document.getElementById("canvas");
				ctx = canvas.getContext("2d");
				draw();
				//return setInterval(draw, 10);
			}

			function draw() {
				clear();
				ctx.fillStyle = "#444444";
				rect();
			}

			function myMove(e){
				if (dragok){
					listNode[currentGrag].posx = e.pageX;
					listNode[currentGrag].posy = e.pageY;
				}
			}

			function addNode(x, y, text){
				var node = {
					posx : x,
					posy : y,
					content  : text
				};
				listNode.push(node);
			}

			function myDown(e){
				for(var i = 0; i < listNode.length; i++)
				{
					if((e.pageX >= listNode[i].posx) && (e.pageX <= listNode[i].posx + 60) && (e.pageY >= listNode[i].posy) && (e.pageY <= listNode[i].posy + 60))
					{
						dragok = true;
						canvas.onmousemove = myMove;
						currentGrag = i;
					}
				}

				function myUp(){
					dragok = false;
					canvas.onmousemove = null;
				}
                //addNode(100, 100, "Node 1");
				init();
				draw();
				//canvas.onmousedown = myDown;
				//canvas.onmouseup = myUp;

			</script>

		</section>
	</body>
	</html>